@{
    ViewData["Title"] = "Juego";
     var usuario = ViewBag.Username;
    var palabra = ViewBag.Palabra;
}

<h1>Juego</h1>
<p>Jugador: @usuario</p>

<div id="palabraMostrada"></div>

<input type="hidden" id="numeroIntentos" value="0">

<p>Letras usadas:</p>
<div id="letrasProbadas"></div>

<input type="text" id="ingreso">

<button onclick="probarLetra()">Arriesgar letra</button>
<button onclick="probarPalabra()">Arriesgar palabra</button>

<form id="formularioFin" method="post" action='@Url.Action("FinJuego","Home")'">
    <input type="hidden" name="intentos" id="cantidadIntentos">
    <button id="botonFin" type="submit">Fin (guardar partida)</button>
</form>

<a id="botonVolver" href='@Url.Action("Index","Home")'">Volver al inicio</a>

<script>
    var PALABRA = "@palabra";
    var letrasMostradas = [];
    var letrasUsadas = [];

    function iniciar() {
        for (var i = 0; i < PALABRA.length; i++) {
            var letra = PALABRA.charAt(i);
            if (esLetra(letra)) {
                letrasMostradas.push("_");
            } else {
                letrasMostradas.push(letra);
            }
        }
        actualizarPantalla();
    }

    function esLetra(letra) {
        var letrasValidas = "abcdefghijklmnñopqrstuvwxyzáéíóúü";
        return letrasValidas.indexOf(letra.toLowerCase()) !== -1;
    }

    function actualizarPantalla() {
        document.getElementById("palabraMostrada").innerHTML = letrasMostradas.join(" ");
        document.getElementById("letrasProbadas").innerHTML = letrasUsadas.join(" ");
        document.getElementById("cantidadIntentos").value = document.getElementById("numeroIntentos").value;
    }

    function sumarIntento() {
        var numI = document.getElementById("numeroIntentos");
        var num = parseInt(numI.value);
        if (isNaN(num)) num = 0;
        numI.value = num + 1;
    }

    function probarLetra() {
        var entrada = document.getElementById("ingreso");
        var letra = (entrada.value || "").toLowerCase();
        entrada.value = "";
        if (letra.length === 0) return;

        for (var i = 0; i < letrasUsadas.length; i++) {
            if (letrasUsadas[i] === letra) {
                alert("Ya probaste esa letra.");
                return;
            }
        }
        letrasUsadas.push(letra);

        var acierto = false;
        for (var ej = 0; ej < PALABRA.length; ej++) {
            if (PALABRA.charAt(ej).toLowerCase() === letra) {
                letrasMostradas[ej] = PALABRA.charAt(ej);
                acierto = true;
            }
        }
        if (!acierto) {
            sumarIntento();
        }

        actualizarPantalla();
        verificarVictoria();
    }

    function probarPalabra() {
        var entrada = document.getElementById("ingreso");
        var propuesta = (entrada.value || "").toLowerCase();
        entrada.value = "";
        if (propuesta.length === 0) return;

        if (propuesta === PALABRA.toLowerCase()) {
            letrasMostradas = PALABRA.split("");
            actualizarPantalla();
            ganar();
        } else {
            alert("¡Incorrecto! Perdiste. Volvé al inicio para jugar de nuevo.");
            document.getElementById("botonVolver");
            document.getElementById("ingreso");
        }
    }

    function verificarVictoria() {
        var completo = true;
        for (var i = 0; i < letrasMostradas.length; i++) {
            if (letrasMostradas[i] === "_") {
                completo = false;
            }
        }
        if (completo) {
            ganar();
        }
    }

    function ganar() {
        var intentos = document.getElementById("numeroIntentos").value;
        alert("¡Felicitaciones! Ganaste en " + intentos + " intentos.");
        document.getElementById("formularioFin");
        document.getElementById("ingreso");
        document.getElementById("cantidadIntentos").value = intentos;
    }

    iniciar();
</script>